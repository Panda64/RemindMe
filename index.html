<!DOCTYPE html>
<html>
    <head>
        <title>RemindMe</title>
        <link rel="stylesheet" href="/resources/CSS/odometer-theme-default.css" />
    </head>
    <body>
        <article id="first-page">
            <h1>Need a Reminder? Look no Further.</h1>
            <form id="main-message">
                <p id="message-title">Message</p>
                    <textarea id="message"></textarea>
            </form>
            <section id="main-method">
                <p id="method-header">Method</p>
                <form id="method-check">
                    <section id="whole-browser">
                        <input type="checkbox" id="browser" class="method">
                        <label for="browser">Browser Notification</label>
                    </section>
                    <section id="whole-email">
                        <input type="checkbox" id="email" class="method" disabled>
                        <label for="email" class="disabled">E-Mail</label>
                    </section>
                    <section id="whole-sms">
                        <input type="checkbox" id="sms" class="method" disabled>
                        <label for="sms" class="disabled">Text Message</label>
                    </section>
                    <section id="whole-phone">
                        <input type="checkbox" id="phone" class="method" disabled>
                        <label for="phone" class="disabled">Phone Call</label>  
                    </section>
                    <section id="whole-mail">
                        <input type="checkbox" id="mail" class="method" disabled>
                        <label for="mail" class="disabled">Mail</label>
                    </section>
                </form>
            </section>
            <p id="time">
                I want to be reminded in 
                <input type="number" id="minutes" min="0"> 
                <span id="min-word">minutes</span>
                and 
                <input type="number" id="seconds" min="0"> 
                <span id="sec-word">seconds.</span>
            </p>
            <button type="button" id="submit" class="reminder-button">Set Reminder</button>
        </article>
        <article id="second-page">
            <h1 id="reminder-phrase">Placeholder</h1>
            <section id="countdown-main">
                <p id="countdown-title">Time Left</p>
                <p id="countdown">
                    <span id="countdown-min" class="odometer">0</span>
                    :
                    <span id="countdown-sec" class="odometer">0</span>
                </p> 
            </section>
        </article>
        <article id="third-page">
            <h1 id="times-up">Times up!</h1>
            <p id ="reminder-outro">This is your reminder to</p>
            <p id="user-message">Placeholder</p>
            <a type="button" id="reset" class="reminder-button" href="#third-page">Set Another Reminder</a>
            <audio id="alarm">
                <source src="resources/Audio/alarm_sound.mp3" type="audio/mp3">
            </audio>
        </article>
    </body>
</html>
<style>
    body {
        font-family: "Arial Black";
        margin: 0;
        color: white;
    }

    article {
        min-height: 100vh;
        overflow: hidden;
    }

    #first-page {
        text-align: center;
        background-color:#45a3e5;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
    }
    
    h1 {
        font-size: 50px;
    }

    .disabled {
        color: rgba(255, 255, 255, 0.5);
    }

    #main-message {
        display: flex;
        justify-content: center;
    }

    #message-title {
        padding-right: 50px;
        font-size: 35px;
    }
    
    #method-header {
        font-size: 35px;
    }

    #method-check {
        display: flex;
        justify-content: space-around;
    }

    textarea {
        width: 500px;
        height: 100px;
        resize: none;
        font-size: 20px;
    }

    #time {
        font-size: 25px;
    }

    input[type=number] {
        background-color: #45a3e5;
        border: none;
        font-family: "Arial Black";
        color: lightgreen;
        font-size: 25px;
        width: 60px;
    }

    .reminder-button {
        background-color: rgb(24, 24, 24);
        color: white;
        font-family: "Arial Black";
        text-decoration: none;
        cursor: pointer;
        border: none;
        width: 250px;
        height: 75px;
        text-align: center;
        font-size: 25px;
        align-self: center;
    }

    #second-page {
        background-color: #66bf39;
        text-align: center;
        display: none;
        flex-direction: column;
        justify-content: flex-start;
    }

    #countdown {
        font-size: 100px;
        margin-top: -15px;
    }

    #countdown-main {
        padding-top: 100px;
    }

    #countdown-title {
        font-size: 35px;
    }

    #third-page {
        background-color: #ff3355;
        display: none;
        flex-direction: column;
        align-items: center;
        position: relative;
    }

    #user-message {
        font-family: "Rockwell Extra Bold";
        font-size: 20px;
        border: 2px solid black;
        padding: 10px;
        margin-left: 100px;
        margin-right: 100px;
    }

    #times-up {
        font-size: 100px;
    }

    #reminder-outro {
        font-size: 30px;
    }

    #reset {
       position: absolute;
       bottom: 0;
       margin-bottom: 30px;
    }

    #reminder-phrase {
        margin-left: 100px;
        margin-right: 100px;
    }

</style>
<script src="/resources/JS/odometer.js"></script>
<script>

    // Declaring variables
    const minutesInput = document.querySelector('#minutes')
    const secondsInput = document.querySelector('#seconds')
    const minWord = document.querySelector('#min-word')
    const secWord = document.querySelector('#sec-word')
    const reminderMessage = document.querySelector('#message')
    const browserCheckbox = document.querySelector('#browser')
    const submitButton = document.querySelector('#submit')
    const secondPage = document.querySelector('#second-page')
    const countdownMin = document.querySelector('#countdown-min')
    const countdownSec = document.querySelector('#countdown-sec')
    const countdownPhrase = document.querySelector('#reminder-phrase')
    const finalReminderMessage = document.querySelector('#user-message')
    const thirdPage = document.querySelector('#third-page')
    const alarmSound = document.querySelector('#alarm')
    const firstPage = document.querySelector('#first-page')
    const resetButton = document.querySelector('#reset')
    const allCheckboxes = document.querySelector('.method')

    const countdownPhrases = ['Got it! Your Reminder is Set.',
                             'All Good to Go!',
                             'Reminder is Locked and Loaded!',
                             'You Have Successfully Set Your Reminder!',
                             'Mission Successful. You will be Reminded when the Timer is Up.',
                             'Nice. Feel Free to Forget Now, I Will Remind You When the Time Comes.']

    const time = {
        minutes: minutesInput.value * 1,
        seconds: secondsInput.value * 1
    }
    
    // Determining whether or not the word "minutes" needs to be plural or singular based on the number inputted by the user
    function validateMinutes() {
        minutesValue = minutesInput.value
        if (minutesValue === "1") {
            return "minute"
        } else {
            return "minutes"
        }
    }

    // Determing whether or not the word "seconds" needs to be plural or singular based on the number inputted by the user
    function validateSeconds() {
        secondsValue = secondsInput.value
        if (secondsValue === "1") {
            return "second"
        } else {
            return "seconds"
        }
    }

    // Displaying the proper form of "minutes" and "seconds" on the screen
    function validateTime() {
        minWord.innerHTML = validateMinutes()
        secWord.innerHTML = validateSeconds()
    }

    // Making sure that the user has filled out all fields before allowing them to click the "Set Reminder" button.
    // If the user fails to fill out all fields and tries to click the button, they will get an alert telling them to fill
    // out all of the fields. If the user is successful in filling out all of the fields and then clicks the button, the page
    // will then transition to the next section: The page will autoscroll to the second section, removing the first section
    // from access in the process, whilst calling on a handful of other functions to get the countdown process started
    function validateFields() {
        minutesValue = minutesInput.value
        secondsValue = secondsInput.value
        messageValue = reminderMessage.value

        if (minutesValue === "" || secondsValue === "" || messageValue === "" || browserCheckbox.checked === false) {
            alert("You must fill out all fields")
        } else {
            secondPage.style.display = "flex"
            SmoothVerticalScrolling(secondPage, 500, "top")
            countdownMin.innerHTML = minutesValue
            countdownSec.innerHTML = secondsValue
            countdownHandler()
            randomCountdownPhrases()
            setTimeout(hideFirstPage, 500)
        }
    }

    // Event listeners to run the "minutes" and "seconds" word validation whenver the user changes a timer input
    minutesInput.addEventListener('input', validateTime)
    secondsInput.addEventListener('input', validateTime)

    // Event listeners for when any of the two buttons throughout the site are clicked
    submitButton.addEventListener('click', validateFields)
    resetButton.addEventListener('click', resetReminder)

    // Function that allows for the smooth scrolling from one section of a page to another even with Safari 
    // (Safari does not natively support the "autoscroll: smooth" attribute)
    function SmoothVerticalScrolling(e, time, where) {
        var eTop = e.getBoundingClientRect().top;
        var eAmt = eTop / 100;
        var curTime = 0;
        while (curTime <= time) {
            window.setTimeout(SVS_B, curTime, eAmt, where);
            curTime += time / 100;
        }
    }

    // Function that is connected to the previous smooth scrolling function. Determines what part of the section to scroll to
    function SVS_B(eAmt, where) {
        if(where == "center" || where == "")
            window.scrollBy(0, eAmt / 2);
        if (where == "top")
            window.scrollBy(0, eAmt);
    }
    
    // Handler function for the countdown timer
    function countdownHandler() {

        var time = {
            minutes: minutesInput.value * 1,
            seconds: secondsInput.value * 1
        };

        var timer = setInterval(countdown, 1000)

        // A functional countdown timer. When the timer reaches zero, it will call on the timesUp() function to move on to 
        // the next section of the site
        function countdown() {
            if (time.seconds > 0) {
                time.seconds--
            } 
            else {
                if (time.minutes > 0) {
                    time.minutes--
                    time.seconds = 60
                }
                else {
                    time.minutes = 0
                    time.seconds = 0
                }
            }

            if (time.minutes > 0 || time.seconds > 0) {
                countdownMin.innerHTML = time.minutes
                countdownSec.innerHTML = time.seconds
            }  else {
                countdownMin.innerHTML = time.minutes
                countdownSec.innerHTML = time.seconds
                clearInterval(timer)
                timesUp()
            }
           
        }
    }

    // Randomly chooses a phrase to display when the countdown timer is running
    function randomCountdownPhrases() {
        const random = Math.floor(Math.random() * countdownPhrases.length)
        
        countdownPhrase.innerHTML = countdownPhrases[random]
    }

    // Makes the third section of the site visible, whilst smooth scrolling to it, along with removing access to the second
    // section (countdown section). This third section will alert the user the the time is up and finally relay the user's
    // intial reminder message back to them. 
    function timesUp() {
        thirdPage.style.display = "flex"
        finalReminderMessage.innerHTML = reminderMessage.value
        SmoothVerticalScrolling(thirdPage, 500, "top")
        setTimeout(hideSecondPage, 500)
        alarmSound.play()
    }

    // These next four functions are for hiding their respective sections from view
    function hideFirstPage() {
        firstPage.style.display = "none"
    }

    function hideSecondPage() {
        secondPage.style.display = "none"
    }

    function hideThirdPage() {
        thirdPage.style.display = "none"
    }

    function hideSecThirPages() {
        secondPage.style.display = "none"
        thirdPage.style.display = "none"
    }

    // Clearing the input fields of the initial reminder setup
    function clearInputFields() {
        reminderMessage.value = ""
        allCheckboxes.checked = false
        minutesInput.value = ""
        secondsInput.value = ""
    }

    // Scrolls back up to the first section with now empty fields for the user to setup a new reminder
    // This function is only called if the user clicks the button to setup another reminder
    function resetReminder() {
        secondPage.style.display = "flex"
        firstPage.style.display = "flex"

        setTimeout(clearInputFields, 100)
        setTimeout(SmoothVerticalScrolling, 0, firstPage, 500, "top")
        setTimeout(hideSecThirPages, 500)
    }

</script>